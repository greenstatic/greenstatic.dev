<!doctype html><html><title>SSL/TLS RGW Configuration on Octopus Ceph Cluster | greenstatic.dev</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content><meta name=keywords content><meta property="og:url" content="https://greenstatic.dev/posts/2020/ssl-tls-rgw-ceph-config/"><meta property="og:title" content="SSL/TLS RGW Configuration on Octopus Ceph Cluster"><meta property="og:description" content="Setting up SSL/TLS on my RADOS Gateway (RGW) Ceph Octopus cluster was a PITA, here&rsquo;s how I did it!"><meta property="og:type" content="article"><meta name=generator content="Hugo 0.75.1"><link rel=stylesheet href=/dist/bootstrap-4.5.0-dist/css/bootstrap.min.css><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/dist/fontawesome-free-5.14.0-web/css/all.min.css><link rel=stylesheet href=https://voh.nipwd.com/greenstatic.dev.css><link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon><link rel=icon href=/images/favicon.ico type=image/x-icon><body class="d-flex flex-column min-vh-100"><div class="container mt-5" style=flex:1><div class=row><div class="col-xs-12 col-sm-12 col-md-4 col-lg-3 order-2 order-md-1 order-lg-1 order-xl-1"><header><div class="text-center mt-3 mb-4"><section><div class=h5><a class=link-no-color href=/><i class="fas fa-home"></i>&nbsp;
greenstatic.dev</a></div></section></div><section><div class=text-center><img class=img-fluid src=/misc/profile.jpg style=max-width:70%;border-radius:50%></div><section class="mt-2 text-center"><div style=font-size:1.3rem;font-weight:500>Gregor Krmelj</div><div class=text-muted style=font-size:.95rem>Software Engineer</div><div class=mt-2 style=font-size:.83rem>An engineer's blog about computers, software, horror IT stories, coding solutions and everything in between.</div></section><section class=mt-3><div><i class="fab fa-github"></i>&nbsp;
<a class=link-no-color href=https://github.com/greenstatic>greenstatic</a></div><div><i class="fa fa-link"></i>&nbsp;
<a class=link-no-color href=https://krmelj.xyz>https://krmelj.xyz</a></div><div><i class="far fa-sticky-note"></i>&nbsp;
Favorite XKCD: <a class=link-no-color href=https://xkcd.com/2166/>#2166</a></div></section></section><hr><section><div class=h6>Categories</div><ul class="list-unstyled mb-0"><li><a class="badge badge-primary" href=/categories/cloud/>cloud</a> <small>(1)</small></li><li><a class="badge badge-primary" href=/categories/infrastructure/>infrastructure</a> <small>(1)</small></li><li><a class="badge badge-primary" href=/categories/security/>security</a> <small>(1)</small></li><li><a class="badge badge-primary" href=/categories/snippet/>snippet</a> <small>(1)</small></li></ul></section><hr><section><div><i class="fa fa-rss"></i>&nbsp;
<a class=link-no-color href=/index.xml>RSS Feed</a></div></section></header></div><div class="col-xs-12 col-sm-12 col-md-8 col-lg-9 order-1 order-md-2 order-lg-2 order-xl-2"><div class="d-md-none d-lg-none d-xl-none mb-4"><section><div class=h5><a class=link-no-color href=/><i class="fas fa-home"></i>&nbsp;
greenstatic.dev</a></div></section>An engineer's blog about computers, software, horror IT stories, coding solutions and everything in between.</div><article role=main><div class=mb-4><h1>SSL/TLS RGW Configuration on Octopus Ceph Cluster</h1><div><div class=mb-2><a href=/categories/cloud class="badge badge-primary font-sm">cloud</a>
<a href=/categories/infrastructure class="badge badge-primary font-sm">infrastructure</a>
<a href=/categories/snippet class="badge badge-primary font-sm">snippet</a>
<a href=/tags/ceph class="badge badge-secondary font-sm">ceph</a>
<a href=/tags/storage class="badge badge-secondary font-sm">storage</a></div><div class=text-muted>July 23, 2020</div></div></div><div class=content><p>Ceph v15.2 aka. Octopus was released this year and along with it a new way of installing Ceph - cephadm.
Ceph is slowly moving service configuration to the orchestrator (e.g. Rook, cephadm) interface.
What this means is that you no longer configure services (i.e. RADOS Gateway - RGW) by editing the <code>ceph.conf</code>
file but rather you use the <code>ceph</code> CLI to store configs into a key-value store.</p><h2 id=configuring-ssltls-for-your-rgw-instance>Configuring SSL/TLS for your RGW Instance</h2><ol><li>Have your RGW&rsquo;s valid SSL/TLS certificate ready on a machine that has access to the <code>ceph</code> CLI<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.</li><li>Run the following commands, replacing the RGW realm, zone and certificate files:<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ ceph config-key set rgw/cert/&lt;rgw_realm&gt;/&lt;rgw_zone&gt;.crt -i &lt;cert_file&gt;  <span style=color:#75715e># replace with .pem certificate</span>
$ ceph config-key set rgw/cert/&lt;rgw_realm&gt;/&lt;rgw_zone&gt;.key -i &lt;key_file&gt;   <span style=color:#75715e># replace with .pem private key</span>
$ ceph config set client.rgw.&lt;rgw_realm&gt;.&lt;rgw_zone&gt; rgw_frontends <span style=color:#e6db74>&#34;beast port=80 ssl_port=443 ssl_certificate=config://rgw/cert/&lt;rgw_realm&gt;/&lt;rgw_zone&gt;.key ssl_private_key=config://rgw/cert/&lt;rgw_realm&gt;/&lt;rgw_zone&gt;.key&#34;</span></code></pre></div></li><li>Restart the RGW, e.g. <code>ceph orch restart rgw</code></li></ol><h2 id=other-rgw-configuration-settings>Other RGW Configuration Settings</h2><p>Configuring using <code>ceph config</code> requires three parameters:</p><ol><li>Who - <code>client.rgw.&lt;rgw_realm>.&lt;rgw_zone></code></li><li>Option - the setting you are configuring</li><li>Value - the value of the setting</li></ol><p>RGW options can be either found in the <a href=https://docs.ceph.com/docs/octopus/radosgw/config-ref/>documentation</a> and/or
consulting the output of <code>ceph config ls | grep -i rgw</code>.</p><p>See <code>ceph config -h</code> for general configuration details (scroll towards the end of the output).</p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>With the cephadm installation, this will most probably be your bootstrapping server (also probably your monitor node).
Gaining access to the <code>ceph</code> CLI tool is usually done by running <code>cephadm shell</code> which drops you into a Docker/Podman container
with the <code>ceph</code> CLI tool available. The container actually has a host filesystem bind mount <code>/var/lib/ceph/&lt;CEPH_ID>/home:/root</code>.
Copying your RGW SSL/TLS certificate on the bootstrap machine in the aforementioned dir will make the certificate available in
the <code>cephadm shell</code>&rsquo;s container in the <code>/root</code> dir. <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div></article></div></div></div><div><footer class="mt-5 bg-dark"><div class="d-flex justify-content-center p-3"><span class="text-muted mx-4">Created by: <a class=text-muted href=https://krmelj.xyz>greenstatic</a></span>
<span class=text-muted>Copyright &copy;
<script type=text/javascript>document.write(new Date().getFullYear())</script><noscript>2020</noscript></span></div></footer></div><script src=/dist/jquery-3.5.1.slim.min.js></script><script src=/dist/bootstrap-4.5.0-dist/js/bootstrap.min.js></script><script src=/js/script.js></script></body></html>